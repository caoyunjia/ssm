<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>及时雨-上下游-融资申请查询</title>
    <link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="js/plugin/kkpager_green.css"/>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/new.css">
    <!-- HTML5 shim and Respond.js for IE6 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <script src="js/jquery.min.js"></script>
    <script src="js/plugin/kkpager.min.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>
    <script src="js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="js/common.js?v=APP_VER"></script>
</head>
<body>

<div class="container m-content">
    <ul id="myTab" class="nav nav-tabs">
        <li class="">
            <a href="" data-toggle="tab" class="curr" style="padding: 10px;">产品选择</a>
        </li>
        <li>
            <a href="" data-toggle="tab" style="padding: 10px;">应收账单信息</a>
        </li>
        <li>
            <a href="" data-toggle="tab" style="padding: 10px;">订单信息</a>
        </li>
        <li>
            <a href="" data-toggle="tab" style="padding: 10px;">融资申请</a>
        </li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <!--产品选择-->
        <div class="tab-pane fade in active tabChild" id="cpxz">
            <div class="m-content">
                <div class="row form-group">
                    <div class="col-xs-6">
                        <label for="" class="col-md-4 control-label">核心企业名称</label>
                        <div class="col-md-8">
                        	<select type="text" class="form-control" id="hxqymc" onchange="select()">
                        	<option></option>
                        	</select>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <label for="" class="col-md-4 control-label">融资产品</label>
                        <div class="col-md-8">
                        	<select type="text" class="form-control" id="rzcp">
                        		<!-- <option value="01">订单融资</option>
                        		<option value="02">应收账款融资</option> -->
                        	</select>
                        </div>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-xs-6">
                        <label for="" class="col-md-4 control-label">融资类型</label>
                        <div class="col-md-8">
                            <select type="text" class="form-control" id="rzlx">
                                <option value='01'>普通</option>
                                <option value='02'>随借随还</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <a href="javascript:void(0);" id="next1" class="btn_query btn btn-default next">下一步</a>
                    </div>
                </div>
            </div>
        </div>


        <div class="tab-pane fade in active tabChild" id="yszdxx">
            <div class="search_result">
                <form class="" id="formId1">
                <table class="table table-bordered table-hover" id="yszkTable1">
                    <thead>
                    <tr>
                    	<th></th>
                        <th>发票号</th>
                        <th>发票代码</th>
                        <th>融资客户名称</th>
                        <th>核心企业名称</th>
                        <th>发票金额(元)</th>
                        <th>发票日期</th>
                        <th>交易对手名称</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- <tr>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">
                            <a style="color: #0044CC;">查看</a>
                        </td>
                    </tr> -->
                    </tbody>
                </table>
                <div style="text-align: left"><a class="more" href="">添加</a></div>
                <div class="col-xs-12">
                    <a href="" id="next2" class="btn_query next" onclick="nextStep2()">下一步 </a>
                </div>
                </form>
        </div>

        <!--订单信息-->
        <div class="tab-pane fade in active tabChild" id="ddxx">
            <div class="search_result">
                <table class="table table-bordered table-hover" id="ddTable">
                    <thead>
                    <tr>
                    	<th></th>
                        <th>订单号</th>
                        <th>货品名称</th>
                        <th>总金额(元)</th>
                        <th>融资客户</th>
                        <th>核心客户</th>
                        <th>订单发起时间</th>
                        <th>订单确认时间</th>
                        <th>交易对手</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- <tr>
                    	<td class="order_"><input type="checkbox" class="ddid" /></td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">
                            <a style="color: #0044CC;">查看</a>
                        </td>
                    </tr>
                     <tr>
                    	<td class="order_"><input type="checkbox" class="ddid" /></td>
                        <td class="order_">兴业2</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">
                            <a style="color: #0044CC;">查看</a>
                        </td>
                    </tr> -->
                    </tbody>
                </table>
                <table class="table table-bordered table-hover" id="yszkTable2">
                    <thead>
                    <tr>
                    	<th></th>
                        <th>发票号</th>
                        <th>发票代码</th>
                        <th>融资客户名称</th>
                        <th>核心企业名称</th>
                        <th>发票金额(元)</th>
                        <th>发票日期</th>
                        <th>交易对手名称</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- <tr>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">兴业1</td>
                        <td class="order_">
                            <a style="color: #0044CC;">查看</a>
                        </td>
                    </tr> -->
                    </tbody>
                </table>
                <div style="text-align: left"><a href="">【 添加 】</a></div>

                <div style="text-align: right;margin-top: 30px"><a href="javascript:void(0);" id="next3" class="next" onclick="nextStep3()">【 下一步 】</a></div>
            </div>
        </div>

        <!--融资详情-->
        <form action="" class="tabChild" id="rzsq">
            <div class="row form-group">
                <div class="col-xs-6">
                    <label class="col-md-4 control-label">申请编号</label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="sqbh" name="sqbh"  placeholder="" readonly>
                    </div>
                </div>
                <div class="col-xs-6">
                    <label for="hxqykhmc" class="col-md-4 control-label">核心企业客户名称</label>
                    <div class="col-md-8">
                        <input class="form-control" size="16" type="text" id="hxqykhmc" name="hxqykhh"/>
                        <input type="hidden" id="dtp_input3" value=""/>
                    </div>
                </div>
            </div>
            <div class="row form-group">
                <div class="col-xs-6">
                    <label for="fpzs" class="col-md-4 control-label">应收账款(元)／订单总数量</label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="fpzs" name="fpzs" placeholder="">
                    </div>
                </div>
                <div class="col-xs-6">
                    <label for="yszkje" class="col-md-4 control-label">应收账款(元)／订单总金额(元)</label>
                    <div class="col-md-8">
                        <input class="form-control" size="16" type="text" id="yszkje" name="yszkje"/>
                        <input type="hidden" id="dtp_input3" value=""/>
                    </div>
                </div>
            </div>
            <div class="row form-group">
                <div class="col-xs-6">
                    <label class="col-md-4 control-label">金融机构名称</label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="jrjg" name="jrjg" placeholder="">
                    </div>
                </div>
                <div class="col-xs-6">
                    <label for="clsj" class="col-md-4 control-label">申请金额(元)</label>
                    <div class="col-md-8">
                        <input class="form-control" size="16" type="text" id="sqje" name="sqje"/>
                        <input type="hidden" id="dtp_input3" value=""/>
                    </div>
                </div>
                <input type="hidden" id="rzje">
                <input type="hidden" id="rzbl">
            </div>
            <div style="text-align: center"><a href="javascript:void(0);" onclick="save()">【保存】</a><a href="javascript:void(0);">【提交审批】</a></div>
        </form>
        <script>
        $("#next1").click(function () {
            requestObj.ajaxServer(
                	requestObj.address.edxxyz,
               		{
                		"khh" : $("#hxqymc").val()
                   	},
                	function(data){
                    	if(data.body != "1"){
							pluginObj.alert("","额度不足");
							return;
                        }
                   		nextStep1();
                        var val = $("#rzcp").val();
                        if (val==01){$("[data-toggle='tab']").eq(2).trigger('click')}else if(val==02){$("[data-toggle='tab']").eq(1).trigger('click'); return false;}
                    });
                    }
        		);

         $("#next2,#next3").click(function () {
             $("[data-toggle='tab']").eq(3).trigger('click');return false;
         });
        	var param = {};						//保存每一个页面所需参数
        	var originalData = new Array();		//原始订单数据
        	var originalYszkData = new Array();	//原始应收账款数据
        	var ddxxArray = new Array();		//已勾选的订单数据
        	var yszkxxArray = new Array();		//已勾选的应收账款数据
        	var fpzs;							//发票张数
        	var yszkje;							//应收账款金额
        	var rzsqObj = {};
            var zxxVO = {};
            var sqVO = {};
            <!--页面tab-->
            $("a[data-toggle='tab']").click(function () {
                $(".tabChild").eq($(this).index('a[data-toggle="tab"]')).show().siblings().hide();
                return false;
            });


            $("#XGMM>#bg_lvjing").click(function () {

                $("#XGMM").hide();
            });
            $(document).ready(function () {
                //初始化日期插件
                dataPiker();
                //获取核心企业
                requestObj.ajaxServer(
                	requestObj.address.getHxqy,
               		{"pageSize":10,
                	 "pageIndex":1,
                	 "khgxlx":"01"
                   	},
                	function(data){
                   		var listVO = data.body.data;
                    	for(var i = 0; i < listVO.length; i++){
                    		$("#hxqymc").append(
								"<option value='"+listVO[i].khh+"'>"+listVO[i].cyfVo.qymc+"</option>"
                            );
                        }
                    }
        		);

            });
            //根据选择的核心企业不同金融产品不同
			function select(){
	            requestObj.ajaxServer(
	                	requestObj.address.getRzcp,
	               		{"pageSize":10,
	                	 "pageIndex":1,
	                	 "khh":$("#hxqymc").val()
	                   	},
	                	function(data){
	                   		$("#rzcp").empty();
	                    	var arr= data.body.rzcp.split(",");
	                    	if(arr.length > 0){
								for( var j = 0 ; j < arr.length ; j++){
									if(arr[j]=="01"){
										$("#rzcp").append(
			        						"<option value='"+arr[j]+"'>订单融资</option>"
			                            );
									}else{
										$("#rzcp").append(
				        						"<option value='"+arr[j]+"'>应收账款融资</option>"
				                        );
									}
								}
	                        }else{
		                        if(data.body.rzcp=="01"){
		                        	$("#rzcp").append(
		        							"<option value='"+data.body.rzcp+"'>订单融资</option>"
		                            );
			                    }else{
			                    	$("#rzcp").append(
		        							"<option value='"+data.body.rzcp+"'>应收账款融资</option>"
		                            );
				                }
	                         }
	                        $("#rzbl").val(data.body.rzbl);
	                    }
	        		);
			}
            function nextStep1(){
                var hxqymc = $("#hxqymc").val();
                var rzcp = $("#rzcp").val();
                var rzlx = $("#rzlx").val();
                param.hxqymc = hxqymc ;
                $("#hxqykhmc").val(param.hxqymc);
                param.rzcp = rzcp ;
                param.rzlx = rzlx ;
				var selectedVal = $("#rzcp").val();
				if(selectedVal == '01'){
					requestObj.ajaxServer(
		                	requestObj.address.jsyRzsqDdQuery,
		               		{"pageSize":10,
		                	 "pageIndex":1,
		                	 "hxqykhh":param.hxqymc
		                   	},
		                	function(data){
		                   		var listVo = data.body.data;
		                    	for(var i = 0; i < listVo.length; i++){
			                    	var tempObj ={};
			                    	tempObj.ddbh = listVo[i].ddbh;
			                    	tempObj.hpmc = listVo[i].hpmc;
			                    	tempObj.zje = listVo[i].zje;
			                    	tempObj.rzfkhh = listVo[i].rzfkhh;
			                    	tempObj.rzfjs = listVo[i].rzfjs;
			                    	tempObj.hxqykhh = listVo[i].hxqykhh;
			                    	tempObj.ddfqsj = listVo[i].ddfqsj;
			                    	tempObj.ddqrsj = listVo[i].ddqrsj;
			                    	tempObj.jydsmc = listVo[i].jydsmc;
			                    	tempObj.zt = listVo[i].zt;
			                    	originalData.push(tempObj);
		                    		$("#ddTable tbody").append(
		                    				"<tr><td><input type='checkbox' class='ddid' /></td>" +
		                    				 "<td>" + listVo[i].ddbh + "</td>" +
		                                    "<td>" + listVo[i].hpmc + "</td>" +
		                                    "<td>" + listVo[i].zje + "</td>" +
		                                    "<td>" + listVo[i].rzfkhh + "</td>" +
		                                    "<td>" + listVo[i].hxqykhh + "</td>" +
		                                    "<td>" + listVo[i].ddfqsj + "</td>" +
		                                    "<td>" + listVo[i].ddqrsj + "</td>" +
		                                    "<td>" + listVo[i].jydsmc + "</td>" +
		                                    "<td>" + listVo[i].zt + "</td>" +
		                                    "<td>"
		                                    +"<a href='XXX.html?khh="+ listVo[i].ddbh +"' style='color: #0044CC;'>查看</a></td>" +
		                                    "</tr>"
		                            );
		                        }

		                    }
		        		);
					requestObj.ajaxServer(
		                	requestObj.address.jsyRzsqYszkQuery,
		               		{"pageSize":10,
		                	 "pageIndex":1,
		                	 "hxqykhh":param.hxqymc
		                   	},
		                	function(data){
		                   		var listVo = data.body.data;
		                    	for(var i = 0; i < listVo.length; i++){
			                    	var tempObj ={};
			                    	tempObj.fph = listVo[i].fph;
			                    	tempObj.fpdm = listVo[i].fpdm;
			                    	tempObj.rzfkhh = listVo[i].rzfkhh;
			                    	tempObj.rzfjs = listVo[i].rzfjs;
			                    	tempObj.hxqykhh = listVo[i].hxqykhh;
			                    	tempObj.fpje = listVo[i].fpje;
			                    	tempObj.kprq = listVo[i].kprq;
			                    	tempObj.jydsmc = listVo[i].jydsmc;
			                    	tempObj.zt = listVo[i].zt;
			                    	originalYszkData.push(tempObj);
		                    		$("#yszkTable2 tbody").append(
		                    				"<tr><td><input type='checkbox' class='fpid' /></td>" +
		                    				 "<td>" + listVo[i].fph + "</td>" +
		                                    "<td>" + listVo[i].fpdm + "</td>" +
		                                    "<td>" + listVo[i].rzfkhh + "</td>" +
		                                    "<td>" + listVo[i].hxqykhh + "</td>" +
		                                    "<td>" + listVo[i].fpje + "</td>" +
		                                    "<td>" + listVo[i].kprq + "</td>" +
		                                    "<td>" + listVo[i].jydsmc + "</td>" +
		                                    "<td>" + listVo[i].zt + "</td>" +
		                                    "<td>"
		                                    +"<a href='XXX.html?khh="+ listVo[i].fph +"' style='color: #0044CC;'>查看</a></td>" +
		                                    "</tr>"
		                            );
		                        }

		                    }
		        		);
					$("#ddxx").css("display","block");
					$("#ddxx").siblings().css("display","none");
				}else{
					requestObj.ajaxServer(
		                	requestObj.address.jsyRzsqYszkQuery,
		               		{"pageSize":10,
		                	 "pageIndex":1,
		                	 "hxqykhh":param.hxqymc
		                   	},
		                	function(data){
		                   		var listVo = data.body.data;
		                    	for(var i = 0; i < listVo.length; i++){
			                    	var tempObj ={};
			                    	tempObj.fph = listVo[i].fph;
			                    	tempObj.fpdm = listVo[i].fpdm;
			                    	tempObj.rzfkhh = listVo[i].rzfkhh;
			                    	tempObj.rzfjs = listVo[i].rzfjs;
			                    	tempObj.hxqykhh = listVo[i].hxqykhh;
			                    	tempObj.fpje = listVo[i].fpje;
			                    	tempObj.kprq = listVo[i].kprq;
			                    	tempObj.jydsmc = listVo[i].jydsmc;
			                    	tempObj.zt = listVo[i].zt;
			                    	originalYszkData.push(tempObj);
		                    		$("#yszkTable1 tbody").append(
		                    				"<tr><td><input type='checkbox' class='fpid' /></td>" +
		                    				 "<td>" + listVo[i].fph + "</td>" +
		                                    "<td>" + listVo[i].fpdm + "</td>" +
		                                    "<td>" + listVo[i].rzfkhh + "</td>" +
		                                    "<td>" + listVo[i].hxqykhh + "</td>" +
		                                    "<td>" + listVo[i].fpje + "</td>" +
		                                    "<td>" + listVo[i].kprq + "</td>" +
		                                    "<td>" + listVo[i].jydsmc + "</td>" +
		                                    "<td>" + listVo[i].zt + "</td>" +
		                                    "<td>"
		                                    +"<a href='XXX.html?khh="+ listVo[i].fph +"' style='color: #0044CC;'>查看</a></td>" +
		                                    "</tr>"
		                            );
		                        }

		                    }
		        		);
					$("#yszdxx").css("display","block");
					$("#yszdxx").siblings().css("display","none");
			    }
            }
            function nextStep2(){
            	var c = $(".fpid");
            	count=0;
            	yszkje=0;
                for(var i = 0 ; i < c.length ; i++){
                    if(c.eq(i).is(':checked')){
                        var tempObj = {};
                        tempObj.fph = originalYszkData[i].fph;
                        tempObj.fpdm = originalYszkData[i].fpdm;
                    	tempObj.rzfkhh = originalYszkData[i].rzfkhh;
                    	tempObj.rzfjs = listVo[i].rzfjs;
                    	tempObj.hxqykhh = originalYszkData[i].hxqykhh;
                    	tempObj.fpje = originalYszkData[i].fpje;
                    	tempObj.kprq = originalYszkData[i].kprq;
                    	tempObj.jydsmc = originalYszkData[i].jydsmc;
                    	tempObj.zt = originalYszkData[i].zt;
                    	yszkxxArray.push(tempObj);
                    	count++;
                        yszkje+=parseInt(originalYszkData[i].fpje);
                    }
                }
                $("#fpzs").val(count);
                $("#yszkje").val(yszkje);
            }
            function nextStep3(){
            	requestObj.ajaxServer(
	                	requestObj.address.jsyRzsqGetSqbh,
	               		{},
	                	function(data){
							$("#sqbh").val(data.body);
		                }
	             );
            	var a = $(".ddid");
            	var b = $(".fpid");
            	count=0;
            	yszkje=0;
                for(var i = 0 ; i < a.length ; i++){
                    if(a.eq(i).is(':checked')){
                        var tempObj = {};
                        tempObj.ddbh = originalData[i].ddbh;
                        tempObj.hpmc = originalData[i].hpmc;
                    	tempObj.rzfkhh = originalData[i].rzfkhh;
                    	tempObj.rzfjs = originalData[i].rzfjs;
                    	tempObj.zje = originalData[i].zje;
                    	tempObj.rzfkhh = originalData[i].rzfkhh;
                    	tempObj.hxqykhh = originalData[i].hxqykhh;
                    	tempObj.ddfqsj = originalData[i].ddfqsj;
                    	tempObj.ddqrsj = originalData[i].ddqrsj;
                    	tempObj.jydsmc = originalData[i].jydsmc;
                    	tempObj.zt = originalData[i].zt;
                    	ddxxArray.push(tempObj);
                    	count++;
                        yszkje+=parseInt(originalData[i].zje);
                    }
                }
                for(var i = 0 ; i < b.length ; i++){
                    if(b.eq(i).is(':checked')){
                        var tempObj = {};
                        tempObj.fph = originalYszkData[i].fph;
                        tempObj.fpdm = originalYszkData[i].fpdm;
                    	tempObj.rzfkhh = originalYszkData[i].rzfkhh;
                    	tempObj.rzfjs = originalYszkData[i].rzfjs;
                    	tempObj.hxqykhh = originalYszkData[i].hxqykhh;
                    	tempObj.fpje = originalYszkData[i].fpje;
                    	tempObj.kprq = originalYszkData[i].kprq;
                    	tempObj.jydsmc = originalYszkData[i].jydsmc;
                    	tempObj.zt = originalYszkData[i].zt;
                    	yszkxxArray.push(tempObj);
                    }
                }
                $("#fpzs").val(count);
                $("#yszkje").val(yszkje);
            }
            function save(){
            	var rzbl = $("#rzbl").val();
            	var sqje = $("#sqje").val();
            	var rzje = parseFloat(parseFloat(rzbl/100)* parseInt(sqje)).toFixed(2);
            	$("#rzje").val(rzje);
            	zxxVO.sqbh = $("#sqbh").val();
            	zxxVO.hxkhh = $("#hxqykhmc").val();
            	zxxVO.je= $("#yszkje").val();
            	zxxVO.sl = $("#fpzs").val();
            	sqVO.sqbh = $("#sqbh").val();
            	sqVO.hxqykhh = $("#hxqykhmc").val();
            	sqVO.fpzs = $("#fpzs").val();
            	sqVO.yszkje = $("#yszkje").val();
            	sqVO.rzcp = param.rzcp;
            	sqVO.rzlx= param.rzlx;
            	sqVO.jrjg= $("#jrjg").val();
            	sqVO.sqje= $("#sqje").val();
            	sqVO.rzje=$("#rzje").val();
            	rzsqObj.zxxVO = zxxVO;
            	rzsqObj.sqVO = sqVO;
            	rzsqObj.ddVO = ddxxArray;
            	rzsqObj.yszkVO = yszkxxArray;
            	requestObj.ajaxServer(
                  		 requestObj.address.sxyrzsq,
                  		 rzsqObj,
                  		 function(){
                      		 pluginObj.alert("","操作成功!!");
                  			window.location.href = './assetManagement.html?v=APP_VER';
       	             },
                  		 function(){}
                )
            }

        </script>
</body>
</html>